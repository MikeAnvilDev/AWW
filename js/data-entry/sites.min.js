function checkForLocallyStored() { console.log("site.js: checkForLocallyStored: check for locally stored"); for (var a = $("#SiteList").attr("data-type"), b = localStorage.length, c = 0; c < b; c++) { var d = localStorage.key(c), e = d.split("-"); e[1] == a && ($("#" + e[0]).addClass("alert"), $("#" + e[0]).find("div.short").prepend("<i>Incomplete</i>")) } } function retrieveGroupList() { displayContentOverlay(!0), $.support.cors; var a = getToken(); null != a ? $.ajax({ url: "https://msapps.acesag.auburn.edu/aww/api/home/GetGroups", type: "GET", contentType: "application/json", dataType: "json", headers: { Authorization: "Bearer " + a }, cache: !1, success: function (a) { $("#Groups").empty(), checkForToken(a) && (groupsObj = a.awW_Groups, parseGroups()) }, error: function (a, b, c) { var d = "Your session has expired."; a.hasOwnProperty("responseText") && (reponseObj = jQuery.parseJSON(a.responseText), d = reponseObj.error_description), clearTokenWithError(d) } }) : clearToken() } function parseGroups() { for (var a = $('<label for="GroupSelector">Group</label>'), b = $('<select id="GroupSelector"><option value="">All My Sites</option></select>'), c = 0; c < groupsObj.length; c++) { groupObject = groupsObj[c]; var d = $('<option value="' + groupObject.groupId + '">' + groupObject.group_Name + "</option>"); b.append(d) } $("#Groups").append(a), $("#Groups").append(b), $("#GroupSelector").change(retrieveSiteList), retrieveSiteList() } function retrieveSiteList() { displayContentOverlay(!0), $.support.cors; var a = getToken(), b = $("#GroupSelector").val(); b.length > 0 ? $.ajax({ url: "https://msapps.acesag.auburn.edu/aww/api/home/GetGroupSites", type: "GET", data: { id: b }, contentType: "application/json", dataType: "json", headers: { Authorization: "Bearer " + a }, cache: !1, success: function (a) { if ($("#SiteList").empty(), checkForToken(a)) { var b = a.webMasterSites; parseLocations(b) } displayContentOverlay(!1) }, error: function (a, b, c) { var d = "Your session has expired."; a.hasOwnProperty("responseText") && (reponseObj = jQuery.parseJSON(a.responseText), d = reponseObj.error_description), clearTokenWithError(d) } }) : $.ajax({ url: "https://msapps.acesag.auburn.edu/aww/api/home/GetUserSites", type: "GET", contentType: "application/json", dataType: "json", headers: { Authorization: "Bearer " + a }, cache: !1, success: function (a) { if ($("#SiteList").empty(), checkForToken(a)) { var b = a.webMasterSites; parseLocations(b) } displayContentOverlay(!1) }, error: function (a, b, c) { var d = "Your session has expired."; a.hasOwnProperty("responseText") && (reponseObj = jQuery.parseJSON(a.responseText), d = reponseObj.error_description), clearTokenWithError(d) } }) } function parseLocations(a) { console.log("sites.js: parseLocations: parse sites object"), console.log(a); var b = $("#GroupSelector").val(), c = a.length; $("#SiteList").append("<h2>" + (b.length > 0 ? "" : "Your ") + c + " Site" + (1 != c ? "s" : "") + (b.length > 0 ? " for " + $("#GroupSelector option:selected").text() : "") + "</h2>"); for (var d = $('<ul class="name-link-list site-list"></ul>'), e = $("#SiteList").attr("data-type"), f = 0; f < a.length; f++) { locationObject = a[f], console.log(locationObject); var g = !1; if ("bacteria" == e ? g = locationObject.active > 0 && locationObject.bActive > 0 : "chemistry" == e && (g = locationObject.active > 0 && locationObject.cActive > 0), g) { var h = $('<li id="' + locationObject.awwSiteCode + '"></li>'), i = $('<div class="details"><table cellpadding="0" cellspacing="0"><tbody><tr><th>Site Code:</th><td>' + locationObject.awwSiteCode + "</td></tr><tr><th>Waterbody:</th><td>" + locationObject.waterbody_Name + "</td></tr><tr><th>Description:</th><td>" + locationObject.description + "</td></tr><tr><th>County:</th><td>" + locationObject.county + "</td></tr><tr><th>Latitude:</th><td>" + locationObject.latitude + "</td></tr><tr><th>Longitude:</th><td>" + locationObject.longitude + "</td></tr></tbody></table></div>"); h.append(i); var j = $('<div class="short">' + locationObject.waterbody_Name + "<p>" + locationObject.description + "</p></div>"); h.append(j); var k = $("<span></span>"); h.append(k); var l = null; l = "bacteria" == e ? $('<a href="../bacteria/default.html' + buildLinkQuery(locationObject) + '"><span>Select</span></a>') : $('<a href="../chemistry/default.html' + buildLinkQuery(locationObject) + '"><span>Select</span></a>'), h.append(l), d.append(h) } } $("#SiteList").append(d), setupSiteList(), checkForLocallyStored() } function buildLinkQuery(a) { var b = "?AwwSiteCode=" + a.awwSiteCode + "&WebMasterSiteId=" + a.site_ID + "&Waterbody_Name=" + encodeURIComponent(a.waterbody_Name) + "&HUC11=" + a.huC11 + "&HUC8=" + a.huC8 + "&HUC6=" + a.huC6 + "&HUC4=" + a.huC4 + "&county=" + encodeURIComponent(a.county) + "&SamplingSiteLocation=" + encodeURIComponent(a.description), c = $("#GroupSelector"); if (c.length > 0) { var d = c[0].selectedIndex; d > 0 && (groupObject = groupsObj[d - 1], b += "&Groupid=" + encodeURIComponent(groupObject.groupId) + "&Group_Name=" + encodeURIComponent(groupObject.group_Name) + "&Group_Abbreviation=" + encodeURIComponent(groupObject.group_Abbreviation)) } return b } function setupSiteList() { var a = $("ul.site-list li > span"); a.each(function () { var a = $(this); a.click(function () { toggleListDetail($(this), !0) }) }) } function toggleListDetail(a, b) { var c = a.parent().find("div.details"), d = a.parent().find("div.short"); b ? (a.unbind("click").click(function () { toggleListDetail($(this), !1) }), d.stop().addClass("trans").slideUp(function () { $(this).removeClass("trans") }), c.stop().addClass("trans").slideDown(function () { $(this).removeClass("trans") })) : (a.unbind("click").click(function () { toggleListDetail($(this), !0) }), d.stop().addClass("trans").slideDown(function () { $(this).removeClass("trans") }), c.stop().addClass("trans").slideUp(function () { $(this).removeClass("trans") })) } var groupsObj = null; $(window).on("load", function () { validateToken(retrieveGroupList) });