function initialize() { var e = addMapOverlay(); e.find("p").text("initializing map..."), google.maps.visualRefresh = !0; var a = document.getElementById("MapCanvas"); center = new google.maps.LatLng(34.8, -86.85), map = new google.maps.Map(a, { center: center, zoom: 7, scaleControl: !0, mapTypeControl: !0, mapTypeId: google.maps.MapTypeId.TERRAIN, mapTypeControlOptions: { style: google.maps.MapTypeControlStyle.DROPDOWN_MENU, mapTypeIds: [google.maps.MapTypeId.SATELLITE, google.maps.MapTypeId.TERRAIN] } }), google.maps.event.addListener(map, "tilesloaded", function () { $("div.gmnoprint.gm-style-mtc").css({ display: "none" }), clearTimeout(controlsTimer), controlsTimer = setTimeout(function () { $("div.gmnoprint.gm-style-mtc").css({ top: 40, left: "auto", right: 0, zIndex: 2, display: "block" }) }, 1e3) }), google.maps.event.addListener(map, "idle", function () { $("div.gmnoprint.gm-style-mtc").css({ display: "none" }), clearTimeout(controlsTimer), controlsTimer = setTimeout(function () { $("div.gmnoprint.gm-style-mtc").css({ top: 40, left: "auto", right: 0, zIndex: 2, display: "block" }) }, 1e3) }), google.maps.event.addListener(map, "maptypeid_changed", function () { $("div.gmnoprint.gm-style-mtc").css({ display: "none" }), clearTimeout(controlsTimer), controlsTimer = setTimeout(function () { $("div.gmnoprint.gm-style-mtc").css({ top: 40, left: "auto", right: 0, zIndex: 2, display: "block" }) }, 1e3) }), $("#Sites-Button").click(updateSites), $("#HUC-Button").click(updateWatersheds), $("#Basin-Select").change(updateBasin), fetchData() } function fetchData() { $basins = $("ul.basins li"), fetchBasin(0) } function fetchBasin(e) { var a = $basins.eq(e); if (a.length > 0) { var t = a.find("input"), n = t.eq(0).val(), o = addMapOverlay(); o.find("p").text("loading " + n + "..."), console.log("water-data-all.js: fetchBasin: fetching Basin " + n); var s = t.eq(1).val(), i = encodeURIComponent(s), r = ["https://www.googleapis.com/fusiontables/v2/query"]; r.push("?sql=" + i), r.push("&key=" + apiKey), $.ajax({ url: r.join(""), dataType: "jsonp", success: function (a) { var t = new google.maps.LatLngBounds; if (a.hasOwnProperty("rows")) for (var n = a.rows, o = 0; o < n.length; o++) { var s = n[o], i = s[0]; if (i.hasOwnProperty("geometry")) var r = i.geometry, l = (s[4], r.coordinates), p = l[0]; else var c = i.geometries, l = (s[4], c[0].coordinates), p = l[0]; for (var d = new Array, u = 0; u < p.length; u++) { var g = p[u], h = g[0], f = g[1], m = new google.maps.LatLng(f, h); d.push({ lat: f, lng: h }), t.extend(m) } var w = new google.maps.Polygon({ paths: d, strokeColor: "#99784a", strokeOpacity: .8, strokeWeight: 2, fillColor: "#99784a", fillOpacity: .35 }); basinPolyArray.push(w), w.setMap(map), map.fitBounds(t), basinBounds.push(t) } fetchBasin(e + 1) } }) } else updateBasin() } function fetchWatersheds(e) { var a = $basins.eq(e), t = a.find("input"), n = new Array, o = t.eq(0).val(); $("#MapOverlay p").text("loading " + o + " watersheds..."), console.log("water-data-all.js: fetchWatersheds: fetching watersheds for Basin " + o); var s = t.eq(2).val(), i = encodeURIComponent(s), r = ["https://www.googleapis.com/fusiontables/v2/query"]; r.push("?sql=" + i), r.push("&key=" + apiKey), $.ajax({ url: r.join(""), dataType: "jsonp", success: function (a) { if (a.hasOwnProperty("rows")) { for (var t = a.rows, o = 0; o < t.length; o++) { for (var s = t[o], i = s[0], r = i.geometry, l = r.coordinates, p = l[0], c = new Array, d = 0; d < p.length; d++) { var u = p[d], g = u[0], h = u[1]; new google.maps.LatLng(h, g); c.push({ lat: h, lng: g }) } var f = new google.maps.Polygon({ paths: c, strokeColor: "#99784a", strokeOpacity: .8, strokeWeight: 2, fillColor: "#99784a", fillOpacity: .35 }); n.push(f), watershedPolyArrays[e] = n } updateWatersheds() } } }) } function fetchSites(e) { var a = $basins.eq(e), t = a.find("input"), n = new Array, o = t.eq(0).val(); $("#MapOverlay p").text("loading " + o + " sites..."), console.log("water-data-all.js: fetchSites: fetching sites for Basin " + o); var s = t.eq(3).val(), i = encodeURIComponent(s), r = ["https://www.googleapis.com/fusiontables/v2/query"]; r.push("?sql=" + i), r.push("&key=" + apiKey), $.ajax({ url: r.join(""), dataType: "json", success: function (a) { if (a.hasOwnProperty("rows")) { for (var t = a.rows, o = 0; o < t.length; o++) { var s = t[o]; n.push(addMarker(s)) } awwSiteMarkerArray[e] = n, updateSites() } } }) } function addMarker(e) { var a = { url: "../../res/images/icons/activeMarker.png", scaledSize: new google.maps.Size(24, 30), origin: new google.maps.Point(0, 0), anchor: new google.maps.Point(12, 30) }, t = { url: "../../res/images/icons/inactiveMarker.png", scaledSize: new google.maps.Size(16, 20), origin: new google.maps.Point(0, 0), anchor: new google.maps.Point(8, 20) }, n = e[6], o = e[7], s = e[4], i = e[11], r = new google.maps.LatLng(n, o), l = new google.maps.Marker({ position: r, title: s, icon: "1" == i ? a : t }), p = createInfoboxContent(e); return google.maps.event.addListener(l, "click", function () { closeInfoBox(), console.log(l.title), mapInfobox = new InfoBox({ content: p, disableAutoPan: !1, pixelOffset: new google.maps.Size(-140, -186), maxWidth: 110, closeBoxURL: "", boxStyle: { width: "280px" } }), mapInfobox.open(map, this), map.panTo(l.getPosition()) }), l } function createInfoboxContent(e) { var a = e[0], t = e[1], n = e[2], o = (e[3], e[4]), s = e[5], i = e[6], r = e[7], l = e[8], p = e[9]; p = parseInt(p); var c = e[10]; c = parseInt(c), console.log(" BacCt = " + c + " siteCode = " + t); var d = (e[11], e[12], e[13], e[14], "https://web.auburn.edu/aww/charts/plotChem.aspx?Sitecode=" + t + "&siteID=" + a + "&ct=" + p), u = "https://web.auburn.edu/aww/charts/plotBac.aspx?Sitecode=" + t + "&siteID=" + a + "&ct=" + c, g = '<div id="Infobox"><div id="Infobox-Content"><b>Aww Site Code:</b> ' + t + "<br /><b>Waterbody:</b> " + o + "<br /><b>Location:</b> " + s + "<br /><b>HUC12:</b> " + n + "<br /><b>Lat:</b> " + i + " <b>Long:</b> " + r + "<br /><b>Last Date:</b> " + l + "<br /><b>Chemistry Samples:</b> " + p + (p > 0 ? ' <a href="' + d + '" target="_blank">View Chart</a>' : "") + "<br /><b>Bacteria Samples:</b> " + c + (c > 0 ? ' <a href="' + u + '" target="_blank">View Chart</a>' : "") + '</div><span class="close" onclick="closeInfoBox();"></span><span class="arrow"></span></div>'; return g } function updateSites() { closeInfoBox(); var e = $("#Basin-Select"), a = e.val(), t = $basins.eq(a).find("input"), n = t.eq(0).val(), o = addMapOverlay(); o.find("p").text("loading " + n + " watersheds..."); var s = $("#Sites-Button"), i = s.prop("checked"), r = awwSiteMarkerArray[a]; null != r ? (i ? (s.closest("label").addClass("highlite"), $.each(r, function (e, a) { $awwSiteMarker = $(this), $awwSiteMarker[0].setMap(map) })) : (closeInfoBox(), s.closest("label").removeClass("highlite"), $.each(r, function (e, a) { $awwSiteMarker = $(this), $awwSiteMarker[0].setMap(null) })), o.remove()) : fetchSites(a) } function updateWatersheds() { closeInfoBox(); var e = $("#Basin-Select"), a = e.val(), t = $basins.eq(a).find("input"), n = t.eq(0).val(), o = addMapOverlay(); o.find("p").text("loading " + n + " watersheds..."); var s = $("#HUC-Button"), i = s.prop("checked"), r = watershedPolyArrays[a]; if (console.log("water-data-all.js: updateWatersheds; "), null != r) { var l = basinPolyArray[a]; i ? (s.closest("label").addClass("highlite"), $.each(r, function () { $watershed = $(this), $watershed[0].setMap(map) }), l.setMap(null)) : (s.closest("label").removeClass("highlite"), $.each(r, function () { $watershed = $(this), $watershed[0].setMap(null) }), l.setMap(map)), updateSites() } else fetchWatersheds(a) } function updateBasin() { closeInfoBox(); var e = $("#Basin-Select"), a = e.val(), t = $basins.eq(a).find("input"), n = t.eq(0).val(), o = addMapOverlay(); o.find("p").text("loading " + n + " watersheds..."), $("h1.heading").text(n), $.each(basinPolyArray, function () { var e = $(this); e[0].setMap(null) }), $.each(watershedPolyArrays, function (e, a) { null != a && $.each(a, function (e, a) { a.setMap(null) }) }), $.each(awwSiteMarkerArray, function (e, a) { null != a && $.each(a, function (e, a) { a.setMap(null) }) }), basinPolyArray[a].setMap(map), updateWatersheds(), setTimeout(function () { recenterMap() }, 600) } function recenterMap() { var e = $("#Basin-Select"), a = e.val(), t = basinBounds[a]; null != map && null != center && map.fitBounds(t) } function sizeMap() { var e = $(window).height(), a = $("header").outerHeight(), t = $("main p.breadcrumbs").outerHeight(), n = e - a - t; $("#MapWrap").css({ height: n }), recenterMap() } function closeInfoBox() { null != mapInfobox && mapInfobox.close() } function addMapOverlay() { var e = $("#MapOverlay"); return 0 == e.length && (e = $('<div id="MapOverlay"><div class="loader"><div><div></div><div></div></div></div><p></p></div>'), $("#MapWrap").append(e)), e } function setUpMap() { sizeMap(), $(window).resize(sizeMap), initialize() } var apiKey = "AIzaSyDcTMT0DVoMWt9IURdklqtRJMawlSoeoLw", map = null, center = null, bounds = null, mapInfobox = null, basinBounds = new Array, basinPolyArray = new Array, watershedPolyArrays = new Array, awwSiteMarkerArray = new Array, $basins = null, controlsTimer = null; $(window).on("load", function () { validateToken(setUpMap) });