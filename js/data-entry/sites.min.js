function checkForLocallyStored() { for (var e = $("#SiteList").attr("data-type"), t = localStorage.length, o = 0; t > o; o++) { var r = localStorage.key(o), a = r.split("-"); a[1] == e && ($("#" + a[0]).addClass("alert"), $("#" + a[0]).find("div.short").prepend("<i>Incomplete</i>")) } } function retrieveGroupList() { displayContentOverlay(!0), $.support.cors; var e = getToken(); null != e ? $.ajax({ url: "https://msapps.acesag.auburn.edu/aww/api/home/GetGroups", type: "GET", contentType: "application/json", dataType: "json", headers: { Authorization: "Bearer " + e }, cache: !1, success: function (e) { $("#Groups").empty(), checkForToken(e) && (groupsObj = e.awW_Groups, parseGroups()) }, error: function (e, t, o) { var r = "Your session has expired."; e.hasOwnProperty("responseText") && (reponseObj = jQuery.parseJSON(e.responseText), r = reponseObj.error_description), clearTokenWithError(r) } }) : clearToken() } function parseGroups() { for (var e = $('<label for="GroupSelector">Group</label>'), t = $('<select id="GroupSelector"><option value="">All My Sites</option></select>'), o = 0; o < groupsObj.length; o++) { groupObject = groupsObj[o]; var r = $('<option value="' + groupObject.groupId + '">' + groupObject.group_Name + "</option>"); t.append(r) } $("#Groups").append(e), $("#Groups").append(t), $("#GroupSelector").change(retrieveSiteList), retrieveSiteList() } function retrieveSiteList() { displayContentOverlay(!0), $.support.cors; var e = getToken(), t = $("#GroupSelector").val(); t.length > 0 ? $.ajax({ url: "https://msapps.acesag.auburn.edu/aww/api/home/GetGroupSites", type: "GET", data: { id: t }, contentType: "application/json", dataType: "json", headers: { Authorization: "Bearer " + e }, cache: !1, success: function (e) { if ($("#SiteList").empty(), checkForToken(e)) { var t = e.webMasterSites; parseLocations(t) } displayContentOverlay(!1) }, error: function (e, t, o) { var r = "Your session has expired."; e.hasOwnProperty("responseText") && (reponseObj = jQuery.parseJSON(e.responseText), r = reponseObj.error_description), clearTokenWithError(r) } }) : $.ajax({ url: "https://msapps.acesag.auburn.edu/aww/api/home/GetUserSites", type: "GET", contentType: "application/json", dataType: "json", headers: { Authorization: "Bearer " + e }, cache: !1, success: function (e) { if ($("#SiteList").empty(), checkForToken(e)) { var t = e.webMasterSites; parseLocations(t) } displayContentOverlay(!1) }, error: function (e, t, o) { var r = "Your session has expired."; e.hasOwnProperty("responseText") && (reponseObj = jQuery.parseJSON(e.responseText), r = reponseObj.error_description), clearTokenWithError(r) } }) } function parseLocations(e) { var t = $("#GroupSelector").val(), o = e.length; $("#SiteList").append("<h2>" + (t.length > 0 ? "" : "Your ") + o + " Site" + (1 != o ? "s" : "") + (t.length > 0 ? " for " + $("#GroupSelector option:selected").text() : "") + "</h2>"); for (var r = $('<ul class="name-link-list site-list"></ul>'), a = $("#SiteList").attr("data-type"), n = 0; n < e.length; n++) { locationObject = e[n]; var i = !1; if ("bacteria" == a ? i = locationObject.active > 0 && locationObject.bActive > 0 : "chemistry" == a && (i = locationObject.active > 0 && locationObject.cActive > 0), i) { var s = $('<li id="' + locationObject.awwSiteCode + '"></li>'), p = $('<div class="details"><table cellpadding="0" cellspacing="0"><tbody><tr><th>Site Code:</th><td>' + locationObject.awwSiteCode + "</td></tr><tr><th>Waterbody:</th><td>" + locationObject.waterbody_Name + "</td></tr><tr><th>Description:</th><td>" + locationObject.description + "</td></tr><tr><th>County:</th><td>" + locationObject.county + "</td></tr><tr><th>Latitude:</th><td>" + locationObject.latitude + "</td></tr><tr><th>Longitude:</th><td>" + locationObject.longitude + "</td></tr></tbody></table></div>"); s.append(p); var c = $('<div class="short">' + locationObject.waterbody_Name + "<p>" + locationObject.description + "</p></div>"); s.append(c); var l = $("<span></span>"); s.append(l); var u = null; u = "bacteria" == a ? $('<a href="../bacteria/default.html' + buildLinkQuery(locationObject) + '"><span>Select</span></a>') : $('<a href="../chemistry/default.html' + buildLinkQuery(locationObject) + '"><span>Select</span></a>'), s.append(u), r.append(s) } } $("#SiteList").append(r), setupSiteList(), checkForLocallyStored() } function buildLinkQuery(e) { var t = "?AwwSiteCode=" + e.awwSiteCode + "&WebMasterSiteId=" + e.site_ID + "&Waterbody_Name=" + encodeURIComponent(e.waterbody_Name) + "&HUC11=" + e.huC11 + "&HUC8=" + e.huC8 + "&HUC6=" + e.huC6 + "&HUC4=" + e.huC4 + "&county=" + encodeURIComponent(e.county) + "&SamplingSiteLocation=" + encodeURIComponent(e.description), o = $("#GroupSelector"); if (o.length > 0) { var r = o[0].selectedIndex; r > 0 && (groupObject = groupsObj[r - 1], t += "&Groupid=" + encodeURIComponent(groupObject.groupId) + "&Group_Name=" + encodeURIComponent(groupObject.group_Name) + "&Group_Abbreviation=" + encodeURIComponent(groupObject.group_Abbreviation)) } return t } function setupSiteList() { var e = $("ul.site-list li > span"); e.each(function () { var e = $(this); e.click(function () { toggleListDetail($(this), !0) }) }) } function toggleListDetail(e, t) { var o = e.parent().find("div.details"), r = e.parent().find("div.short"); t ? (e.unbind("click").click(function () { toggleListDetail($(this), !1) }), r.stop().addClass("trans").slideUp(function () { $(this).removeClass("trans") }), o.stop().addClass("trans").slideDown(function () { $(this).removeClass("trans") })) : (e.unbind("click").click(function () { toggleListDetail($(this), !0) }), r.stop().addClass("trans").slideDown(function () { $(this).removeClass("trans") }), o.stop().addClass("trans").slideUp(function () { $(this).removeClass("trans") })) } var groupsObj = null; $(window).on("load", function () { validateToken(retrieveGroupList) });