function uploadImageData() { var e = null, e = $("#ImageUpload")[0].files[0]; if (e.type.match("image/png") || e.type.match("image/jpeg") || e.type.match("image/bmp") || e.type.match("image/gif")) { var a = new FormData; a.append("photos[]", e, e.name), uploadImageFile(a), displayUploadImage(e) } else alert("Invalid Image Format") } function displayUploadImage(e) { $("#ImagePreview").show().css({ opacity: 0 }).append("<img/>"), $("#ImagePreview").append("<p>Image Preview</p>"); var a = new FileReader; a.onload = function (e) { $("#ImagePreview img").attr("src", e.target.result), $("#ImagePreview").animate({ opacity: 1 }, 3e3) }, a.readAsDataURL(e) } function uploadImageFile(e) { $("div.imageInputs").hide(), $("#ImageStatus").append('<div class="imageProgress"><div class="progressBar"><p class="label">uploading...</p><span class="bar"></span><p class="percentage">0<span>%</span></p></div></div>'), jQuery.support.cors = !0; var a = getToken(); $.ajax({ xhr: function () { var e = new window.XMLHttpRequest; return e.upload.addEventListener("progress", function (e) { if (e.lengthComputable) { var a = e.loaded / e.total; updateImageUploadProgress(100 * a) } }, !1), e }, type: "POST", url: "https://msapps.acesag.auburn.edu/aww/api/home/SubmitImage?siteId=" + $("#WebMasterSiteId").val(), data: e, processData: !1, contentType: !1, headers: { Authorization: "Bearer " + a }, success: function (e) { completeImageUpload(e.newfilepath) }, error: function (e, a, t) { completeImageUpload(), displayErrorMessage(!0, "An error has occurred. The image could not be uploaded.") } }) } function updateImageUploadProgress(e) { var a = $("#ImageStatus div.progressBar span.bar"); a.css({ width: e + "%" }); var t = $("#ImageStatus div.progressBar p.percentage"); t.html(Math.ceil(e) + "<span>%</span>") } function completeImageUpload(e) { var a = $("<img />"), t = $("<div></div>"); t.append(a), $("#ImageLoaded").append(t), a.on("load", function () { $("div.imageInputs").show(), $("#ImageStatus").empty(), $("#ImagePreview").empty().hide(), t.append("<p>Image Saved</p>"), t.css({ height: "auto" }).animate({ opacity: 1 }, 3e3, function () { $(this).find("p").fadeOut(function () { $(this).remove() }) }) }).attr("src", e) } function checkImageSubmit() { var e = $("#Image-Progress"); return e.length > 0 && alert("Please do not leave the page. There is an image upload in progress."), 0 == e.length } $(document).ready(function () { $("body").find("a").click(function () { return checkImageSubmit() }), $("#ImageUpload").change(function () { uploadImageData() }) });