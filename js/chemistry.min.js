function loadData() { token = getToken(); var e = jwt_decode(token); $("#SubmitterContactId").val(e.role[1]), $("div.authorization h2").text("Submitted by: " + e.role[2]), $("#Groupid").val(decodeURIComponent(getQueryVariable("Groupid"))), $("#Group_Name").val(decodeURIComponent(getQueryVariable("Group_Name"))), $("#Group_Abbreviation").val(decodeURIComponent(getQueryVariable("Group_Abbreviation"))), $("#AwwSiteCode").val(decodeURIComponent(getQueryVariable("AwwSiteCode"))), $("#WebMasterSiteId").val(decodeURIComponent(getQueryVariable("WebMasterSiteId"))), $("#Watershed").val(decodeURIComponent(getQueryVariable("Watershed"))), $("#Waterbody_Name").val(decodeURIComponent(getQueryVariable("Waterbody_Name"))), $("#HUC11").val(decodeURIComponent(getQueryVariable("HUC11"))), $("#HUC8").val(decodeURIComponent(getQueryVariable("HUC8"))), $("#HUC6").val(decodeURIComponent(getQueryVariable("HUC6"))), $("#HUC4").val(decodeURIComponent(getQueryVariable("HUC4"))), $("#county").val(decodeURIComponent(getQueryVariable("county"))), $("#state").val(decodeURIComponent(getQueryVariable("state"))), $("#SamplingSiteLocation").val(decodeURIComponent(getQueryVariable("SamplingSiteLocation"))) } function setUpCalculations() { $("#DO1, #DO2").keyup(calculateAverageDO), $("#DO1, #DO2").blur(calculateAverageDO), $("#SampleDate, #SampleTime").keyup(combineDateTime), $("#SampleDate, #SampleTime").blur(combineDateTime), $("#Alkalinity").keyup(calculateAlkalinity), $("#Alkalinity").blur(calculateAlkalinity), $("#Hardness").keyup(calculateHardness), $("#Hardness").blur(calculateHardness), $("#Turb1, #Turb2").keyup(calculateTurbity), $("#Turb1, #Turb2").blur(calculateTurbity), $("#CertificationConfirmation").click(updateAuthorization) } function calculateAverageDO() { var e = $("#DO1").val(); e.length > 0 ? validateDecimal(e) && (e = 0) : e = 0, e = parseFloat(e); var a = $("#DO2").val(); a.length > 0 ? validateDecimal(a) && (a = 0) : a = 0, a = parseFloat(a); var t = 0; t = Math.abs(a - e) > 6 ? "" : (e + a) / 2, $("#AvgDo").val(t) } function calculateAlkalinity() { var e = $("#Alkalinity").val(); e.length > 0 ? validateDecimal(e) && (e = 0) : e = 0; var a = 5 * e; $("#Alkalinity-calculated").val(a) } function calculateHardness() { var e = $("#Hardness").val(); e.length > 0 ? validateDecimal(e) && (e = 0) : e = 0; var a = 10 * e; $("#Hardness-calculated").val(a) } function calculateTurbity() { var e = $("#Turb1").val(); e.length > 0 ? validateDecimal(e) && (drops1 = 0) : e = 0; var a = 50, t = 50 / a * 5 * e; $("#Turb1-calculated").val(t); var o = $("#Turb2").val(); o.length > 0 ? validateDecimal(o) && (o = 0) : o = 0, a = 25, t = 50 / a * 5 * o, $("#Turb2-calculated").val(t) } function validateDecimal(e) { return -1 == e.search(/^\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*$/) } function combineDateTime() { var e = $("#SampleDate").val(), a = $("#SampleTime").val(); e.length > 0 && a.length > 0 ? $("#SampleDateTime").val(e + " " + a) : $("#SampleDateTime").val("") } function updateMonitors() { var e = $("#Monitors ul li input"); $.each(e, function () { var e = $(this); e.prop("checked") ? e.closest("label").addClass("highlite") : e.closest("label").removeClass("highlite") }) } function updateAuthorization() { var e = $("#CertificationConfirmation"); e.prop("checked") ? e.closest("div.authorization").addClass("highlite") : e.closest("div.authorization").removeClass("highlite") } function loadMonitors() { $.support.cors = !0; var e = getToken(); $.ajax({ url: "https://msapps.acesag.auburn.edu/aww/api/home/GetSiteMonitors", dataType: "json", type: "GET", data: { id: $("#WebMasterSiteId").val() }, contentType: "application/json", headers: { Authorization: "Bearer " + e }, cache: !1, success: function (e) { var a = $("#Monitors ul"); $.each(e.monitors, function (e, t) { var o = $("<li></li>"), l = $("<label>" + t.firstName + " " + t.lastName + "</label>"), i = $('<input id="Monitor_' + t.contactID + '" type="checkbox" value="' + t.contactID + '" name="MonitorIDs" ml-val ml-val-required="true" ml-val-label="A monitor is required."/>'); i.click(updateMonitors), a.append(o), o.append(l), l.append(i), loadAutoSaveAndLocal() }) }, error: function (e, a, t) { displayErrorMessage(!0, "An error has occurred.  No monitors for this site were found.  Your entry will be saved, but monitors must be added to submit.") } }) } function loadChemistry() { loadData(), setUpCalculations(), loadMonitors() } function loadAutoSaveAndLocal() { storedKeyName = $("#AwwSiteCode").val() + "-chemistry", loadLocallyStored(storedKeyName), setUpAutoSave($("form.ml-validation"), storedKeyName), updateMonitors(), updateAuthorization() } function submitChemForm(e, a) { if (displayContentOverlay(!0), a) { var t = $(e), o = t.closest("form.ml-validation"); $.support.cors; var l = getToken(), i = o.serialize(), r = o.attr("ml-post-to"); $.ajax({ url: r, type: "POST", headers: { Authorization: "Bearer " + l }, data: i, dataType: "json", cache: !1, success: function (e) { var a = $("#AwwSiteCode").val(); o.hide(), clearLocallyStoredForm(a + "-chemistry"), displayContentOverlay(!1), $("#Success-Section").show() }, error: function (e, a, t) { displayErrorMessage(!0, "An error has occurred.  Chemistry data could not be submitted.  Your entry is saved and can be submitted at a later time."), displayContentOverlay(!1) } }) } else displayContentOverlay(!1) } var storedKeyName = null; $(window).on("load", function () { validateToken(loadChemistry) });