function retrieveSites() { jQuery.support.cors = !0, $.ajax({ url: "https://msapps.acesag.auburn.edu/aww/api/public/GetUserSites", dataType: "json", type: "GET", contentType: "application/json", cache: !1, success: function (e) { sitesArray = e.webMasterSites, populateSitesList(), retrieveGroups() }, error: function (e, a, r) { displayContentOverlay(!1), displayErrorMessage(!0, "An error has occurred.  Unable to fetch sites. Please try again later.") } }) } function sortSitesArrayByAWWSiteCode(e, a) { var r = parseInt(e.awwSiteCode), t = parseInt(a.awwSiteCode); return t > r ? -1 : r > t ? 1 : 0 } function sortSitesArrayByHUC(e, a) { var r = parseInt(e.huC11), t = parseInt(a.huC11); return t > r ? -1 : r > t ? 1 : 0 } function removeDuplicatesFromSortedArray(e) { for (var a = e.length - 1; a > 0; a--) e[a].huC11 == e[a - 1].huC11 && e[a].awwSiteCode == e[a - 1].awwSiteCode && e.splice(a, 1); return e } function retrieveMonth(e) { var a = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]; return a[parseInt(e) - 1] } function populateSitesList() { displayContentOverlay(!0); var e = parseInt($("#Search-Type").val()), a = parseInt($("#Data-Type").val()), r = 0 == a ? "https://web.auburn.edu/aww/charts/plotChem.aspx" : "https://web.auburn.edu/aww/charts/plotBac.aspx", t = $("#AWW-Watershed").val(), h = $("#HUC6-Basin").val(), s = $("#HUC10-Watershed").val(); listArray = jQuery.extend(!0, [], sitesArray), 0 == e ? listArray.sort(sortSitesArrayByAWWSiteCode) : listArray.sort(sortSitesArrayByHUC), listArray = removeDuplicatesFromSortedArray(listArray); var i = $("#Sites-List"); i.empty(), i.append("<thead><tr><th><span>Site </span>Code</th><th>Waterbody</th><th>Location</th><th>Lat, Lng</th><th><span>Last </span>Date</th><th>Records</th><th>View</th></tr></thead>"); var o = $("<tbody></tbody>"); i.append(o), $.each(listArray, function (i, c) { var u = !0, d = parseInt(0 == a ? c.chemCt : c.bacCt); if (u = 0 == d ? !1 : u, 0 == e && (u = null != c.awwSiteCode ? c.awwSiteCode.slice(0, 2) != t ? !1 : u : !1), 1 == e && (null != c.huC11 ? (u = c.huC11.slice(0, 6) != h ? !1 : u, s.length > 0 && (u = c.huC11.slice(0, 10) != s ? !1 : u)) : u = !1), u) { var n = $('<tr siteCode="' + c.awwSiteCode + '"></tr>'); n.append('<td><a href="' + r + "?SiteCode=" + c.awwSiteCode + "&siteID=" + c.site_ID + "&Waterbody=" + encodeURIComponent(c.waterbody_Name) + "&Latitude=" + c.latitude + "&Longitude=" + c.longitude + "&Description=" + encodeURIComponent(c.description) + '" target="_blank">' + c.awwSiteCode + "</a></td> "), n.append("<td>" + c.waterbody_Name + "</td> "), n.append("<td>" + c.description + "</td> "), n.append("<td>" + c.latitude + ", " + c.longitude + "</td> "); var p = 0 == a ? c.lastCDate : c.lastBDate; if (null != p) { var l = p.split("T"), w = l[0].split("-"); n.append("<td>" + w[2] + " " + retrieveMonth(w[1]) + " " + w[0] + "</td> ") } else n.append("<td>None</td> "); n.append("<td>" + d + "</td> "); var C = $('<span class="image" siteid="' + c.site_ID + '" title="' + c.waterbody_Name + " " + c.description + '"></span>'); C.click(function () { displayImages($(this)) }); var v = $('<span class="map" geo="' + c.latitude + "," + c.longitude + '" title="' + c.waterbody_Name + " " + c.description + '"></span>'); v.click(function () { displayMap($(this)) }); var k = $("<td></td>"); k.append(C), k.append(v), n.append(k), o.append(n) } }), populateGroupSelect() } function populateHUCWatersheds() { var e = $("#HUC6-Basin")[0].selectedIndex, a = $("#HUC10-Watershed"); a.empty(), a.append('<option value="">All</option>'); var r = huc10Watersheds[e]; $.each(r, function (e, r) { a.append('<option value="' + r.huc10 + '">' + r.watershed + "</option>") }), populateSitesList() } function updateSearchType() { displayContentOverlay(!0); var e = parseInt($("#Search-Type").val()); 0 == e ? ($("#HUC-Search").stop().hide(), $("#AWW-Search").stop().fadeIn(function () { populateSitesList() })) : ($("#HUC-Search").stop().fadeIn(function () { populateHUCWatersheds() }), $("#AWW-Search").stop().hide()) } function retrieveGroups() { jQuery.support.cors = !0, $.ajax({ url: "https://msapps.acesag.auburn.edu/aww/api/public/GetGroupSites", dataType: "json", type: "GET", contentType: "application/json", cache: !1, success: function (e) { populateGroupsList(e.awW_Groups) }, error: function (e, a, r) { displayContentOverlay(!1), displayErrorMessage(!0, "An error has occurred.  Unable to fetch group names. Please try again later.") } }) } function populateGroupsList(e) { $.each(e, function (e, a) { var r = "", t = "", h = "", s = a.sites; $.each(s, function (e, a) { null != a.awwSiteCode && a.awwSiteCode.length >= 2 && (r += a.awwSiteCode.slice(0, 2) + ",", t += a.awwSiteCode + ","), null != a.huC11 && a.huC11.length >= 2 && (h += a.huC11 + ",") }); var i = { groupID: a.groupId, groupName: a.group_Name, awwWatersheds: r, awwSites: t, huc11s: h }; groupsArray.push(i) }), groupsArray.sort(sortGroupsByName), populateGroupSelect(), $("div.group-loading").remove(), displayContentOverlay(!1) } function populateGroupSelect() { var e = $("#AWW-Watershed").val(), a = $("#AWW-Group"); a.empty(), a.append('<option value="">All Groups</option>'), $.each(groupsArray, function (r, t) { var h = t.awwWatersheds; h.indexOf(e + ",") > -1 && a.append('<option value="' + r + '">' + t.groupName + "</option>") }), displayContentOverlay(!1) } function sortGroupsByName(e, a) { var r = e.groupName, t = a.groupName; return t > r ? -1 : r > t ? 1 : 0 } function updateSitesViewByGroup() { var e = $("#AWW-Group").val(); if (e.length > 0) { $("#Sites-List tbody tr").hide(), e = parseInt(e); var a = groupsArray[e], r = a.awwSites.split(","); $.each(r, function (e, a) { a.length > 0 && $('#Sites-List tr[siteCode="' + a + '"]').slideDown() }) } else $("#Sites-List tr").slideDown() } function displayMap(e) { var a = openDetailView(); a.stop().fadeIn(); var r = e.attr("geo").split(","); a.append("<h2>" + e.attr("title") + "</h2>"), a.append('<a class="directions" href="https://www.google.com/maps/dir/121+Bragg+Avenue,+Auburn,+AL/' + r[0] + "," + r[1] + '/" target="_blank">Get Directions</a>'), a.append('<div id="MapCanvas"></div>'), initializeMap(r), $(window).resize(recenterMap) } function initializeMap(e) { google.maps.visualRefresh = !0; var a = document.getElementById("MapCanvas"); mapcenter = new google.maps.LatLng(e[0], e[1]), map = new google.maps.Map(a, { center: mapcenter, zoom: 12, scaleControl: !0, mapTypeControl: !0, mapTypeId: google.maps.MapTypeId.TERRAIN, mapTypeControlOptions: { style: google.maps.MapTypeControlStyle.DROPDOWN_MENU, mapTypeIds: [google.maps.MapTypeId.SATELLITE, google.maps.MapTypeId.TERRAIN] } }), addMarker() } function addMarker() { var e = { url: "../../../res/images/icons/activeMarker.png", scaledSize: new google.maps.Size(24, 30), origin: new google.maps.Point(0, 0), anchor: new google.maps.Point(12, 30) }; new google.maps.Marker({ map: map, position: mapcenter, icon: e }) } function recenterMap() { null != map && null != mapcenter && map.setCenter(mapcenter) } function displayImages(e) { var a = openDetailView(); a.append('<div id="Image-Loader"><div><div></div><div></div></div></div>'), a.append("<h2>" + e.attr("title") + "</h2>"), a.append('<div id="ImageCanvas"></div>'), a.fadeIn(), retrieveImages(e) } function retrieveImages(e) { var a = e.attr("siteid"); jQuery.support.cors = !0, $.ajax({ url: "https://msapps.acesag.auburn.edu/aww/api/public/GetImagesBySiteID?siteId=" + a, dataType: "json", type: "GET", contentType: "application/json", cache: !1, success: function (e) { populateImages(e.images), $("#Image-Loader").fadeOut(function () { $(this).remove() }) }, error: function (e, a, r) { displayContentOverlay(!1), displayErrorMessage(!0, "An error has occurred.  Unable to fetch group names. Please try again later.") } }) } function populateImages(e) { if (null != e) { var a = $("#ImageCanvas"); $.each(e, function (e, r) { var t = $("<img />"); a.append(t), t.on("load", function () { var e = $('<div class="imageWrap"></div>'), r = $('<a target="_blank"></a>'); r.css({ "background-image": "url(" + $(this).attr("src") + ")" }), r.attr("href", $(this).attr("src")), e.append(r), a.append(e), t.remove(), e.hide().fadeIn() }).css({ height: 0, width: 0 }).attr("src", r) }) } } function openDetailView() { var e = $('<p class="detail-close"><span class="top"></span><span class="bottom"></span></p>'); e.click(closeDetailView); var a = $('<div class="detail-view"></div>'); return a.append(e), $("body").append(a), a } function closeDetailView() { mapcenter = null, map = null, $("div.detail-view").stop().fadeOut(function () { $(this).remove() }) } var sitesArray = null, listArray = null, groupsArray = new Array, huc10Watersheds = [[{ huc10: "0603000602", watershed: "Cedar Creek" }, { huc10: "0603000506", watershed: "Cypress Creek" }, { huc10: "0603000210", watershed: "Flint Creek" }, { huc10: "0603000108", watershed: "Guntersville Lake-Short Creek" }, { huc10: "0603000105", watershed: "Guntersville Lake-South Sauty Creek" }, { huc10: "0603000107", watershed: "Guntersville Lake-Town Creek" }, { huc10: "0603000205", watershed: "Huntsville Spring Branch-Indian Creek" }, { huc10: "0603000207", watershed: "Limestone Creek" }, { huc10: "0603000204", watershed: "Lower Flint River" }, { huc10: "0603000109", watershed: "Lower Guntersville Lake" }, { huc10: "0603000202", watershed: "Lower Paint Rock River" }, { huc10: "0603000104", watershed: "Mud Creek-Tennessee River" }, { huc10: "0603000503", watershed: "Mud Creek-Town Creek" }, { huc10: "0603000208", watershed: "Piney Creek" }, { huc10: "0603000212", watershed: "Second Creek-Wheeler Lake" }, { huc10: "0603000403", watershed: "Sugar Creek" }, { huc10: "0603000211", watershed: "Swan Creek-Wheeler Lake" }, { huc10: "0603000508", watershed: "Tennessee River-Pickwick Lake" }, { huc10: "0603000209", watershed: "Tennessee River-Wheeler Lake" }, { huc10: "0603000601", watershed: "Upper Bear Creek" }, { huc10: "0603000203", watershed: "Upper Flint River" }, { huc10: "0603000106", watershed: "Upper Guntersville Lake" }, { huc10: "0603000201", watershed: "Upper Paint Rock River" }, { huc10: "0603000206", watershed: "Wheeler Lake-Cotaco Creek" }, { huc10: "0603000102", watershed: "Widows Creek-Tennessee River" }, { huc10: "0603000505", watershed: "Wilson Lake-Shoal Creek" }], [{ huc10: "0316011305", watershed: "Big Brush Creek" }, { huc10: "0316011301", watershed: "Big Sandy Creek" }, { huc10: "0316011202", watershed: "Big Yellow Creek-Black Warrior River" }, { huc10: "0316011204", watershed: "Black Warrior River-North River" }, { huc10: "0316011002", watershed: "Brushy Creek" }, { huc10: "0316010906", watershed: "Cane Creek-Mulberry Fork" }, { huc10: "0316011003", watershed: "Clear Creek" }, { huc10: "0316011302", watershed: "Cypress Creek-Black Warrior River" }, { huc10: "0316011203", watershed: "Davis Creek-Black Warrior River" }, { huc10: "0316011101", watershed: "Headwaters Locust Fork" }, { huc10: "0316011306", watershed: "Hemphill Bend-Black Warrior River" }, { huc10: "0316011205", watershed: "Hurricane Creek-Black Warrior River" }, { huc10: "0316010904", watershed: "Lost Creek" }, { huc10: "0316011104", watershed: "Lower Locust Fork" }, { huc10: "0316010703", watershed: "Lower Sipsey Creek-Tombigbee River" }, { huc10: "0316011103", watershed: "Middle Locust Fork" }, { huc10: "0316010902", watershed: "Middle Mulberry Fork" }, { huc10: "0316011005", watershed: "Mulberry Fork" }, { huc10: "0316010903", watershed: "Mulberry Fork-Blackwater Creek" }, { huc10: "0316010302", watershed: "Purgatory Creek-Beaver Creek" }, { huc10: "0316011004", watershed: "Rock Creek" }, { huc10: "0316011001", watershed: "Sipsey Fork" }, { huc10: "0316010301", watershed: "Upper Buttahatchee River" }, { huc10: "0316011102", watershed: "Upper Locust Fork" }, { huc10: "0316010901", watershed: "Upper Mulberry Fork" }, { huc10: "0316011201", watershed: "Valley Creek" }, { huc10: "0316010905", watershed: "Wolf Creek" }], [{ huc10: "0315010603", watershed: "Big Canoe Creek-Coosa River" }, { huc10: "0315010601", watershed: "Big Willis Creek" }, { huc10: "0315010602", watershed: "Black Creek-Coosa River" }, { huc10: "0315010906", watershed: "Blue Creek-Lake Martin" }, { huc10: "0315010606", watershed: "Blue Eye Creek-Coosa River" }, { huc10: "0315010501", watershed: "Cedar Creek" }, { huc10: "0315011004", watershed: "Channahatchee Creek" }, { huc10: "0315010907", watershed: "Chapman Creek" }, { huc10: "0315010506", watershed: "Chattooga River" }, { huc10: "0315011002", watershed: "Chewacla Creek" }, { huc10: "0315010605", watershed: "Choccolocco Creek" }, { huc10: "0315011009", watershed: "Chubbehatchee Creek-Tallapoosa River" }, { huc10: "0315011006", watershed: "Cubahatchee Creek" }, { huc10: "0315010707", watershed: "Hatchet Creek" }, { huc10: "0315010904", watershed: "Hillabee Creek" }, { huc10: "0315010810", watershed: "Ketchepedrakee Creek-Tallapoosa River" }, { huc10: "0315011008", watershed: "Line Creek" }, { huc10: "0315010508", watershed: "Lower Little River" }, { huc10: "0315010510", watershed: "Lower Terrapin Creek-Weiss Lake" }, { huc10: "0315010505", watershed: "Mills Creek" }, { huc10: "0315010705", watershed: "Peckerwood Creek-Coosa River" }, { huc10: "0315010905", watershed: "Sandy Creek" }, { huc10: "0315010608", watershed: "Shoal Creek-Coosa River" }, { huc10: "0315011001", watershed: "Sougahatchee Creek" }, { huc10: "0315010503", watershed: "Spring Creek" }, { huc10: "0315010507", watershed: "Straight Creek-Upper Little River" }, { huc10: "0315010901", watershed: "Tallapoosa River-R. L. Harris Lake" }, { huc10: "0315010701", watershed: "Tallaseehatchee Creek" }, { huc10: "0315010604", watershed: "Tallasseehatchee Creek-Coosa River" }, { huc10: "0315010509", watershed: "Terrapin Creek" }, { huc10: "0315010908", watershed: "Timbergut Creek-Tallaposa River" }, { huc10: "0315011003", watershed: "Uphapee Creek" }, { huc10: "0315010502", watershed: "Upper Coosa River" }, { huc10: "0315010708", watershed: "Walnut Creek-Coosa River" }, { huc10: "0315010704", watershed: "Waxahatchee Creek" }, { huc10: "0315010706", watershed: "Weogufka Creek" }, { huc10: "0315010709", watershed: "Weoka Creek-Coosa River" }], [{ huc10: "0315020102", watershed: "Autauga Creek" }, { huc10: "0315020303", watershed: "Big Swamp Creek-Alabama River" }, { huc10: "0315020202", watershed: "Buck Creek-Cahaba River" }, { huc10: "0315020103", watershed: "Catoma Creek" }, { huc10: "0315020201", watershed: "Headwaters Cahaba River" }, { huc10: "0315020107", watershed: "Jones Bluff Lake-Alabama River" }, { huc10: "0315020204", watershed: "Little Cahaba River" }, { huc10: "0315020109", watershed: "Little Mulberry Creek" }, { huc10: "0315020209", watershed: "Lower Cahaba River" }, { huc10: "0315020206", watershed: "Mill Creek-Cahaba River" }, { huc10: "0315020101", watershed: "Mortar Creek-Alabama River" }, { huc10: "0315020110", watershed: "Mulberry Creek" }, { huc10: "0315020304", watershed: "Pine Barren Creek" }, { huc10: "0315020104", watershed: "Pintlala Creek" }, { huc10: "0315020203", watershed: "Shades Creek" }, { huc10: "0315020401", watershed: "Silver Creek" }, { huc10: "0315020112", watershed: "Soapstone Creek" }, { huc10: "0315020106", watershed: "Swift Creek" }, { huc10: "0315020105", watershed: "Tallawessee Creek-Alabama River" }, { huc10: "0315020205", watershed: "Upper Cahaba River" }, { huc10: "0315020207", watershed: "Waters Creek-Cahaba River" }], [{ huc10: "0313000313", watershed: "Barbour Creek-Chattahoochee River" }, { huc10: "0313000401", watershed: "Cemochehobee Creek-Chattahoochee River" }, { huc10: "0313000211", watershed: "Chattahoochee River-Lake Harding" }, { huc10: "0313000408", watershed: "Chattahoochee River-Lake Seminole" }, { huc10: "0313000316", watershed: "Chattahoochee River-Walter F. George Reservoir" }, { huc10: "0313001202", watershed: "Cowarts Creek-Chipola River" }, { huc10: "0313000309", watershed: "Cowikee Creek-Chattahoochee River" }, { huc10: "0313000304", watershed: "Little Uchee Creek" }, { huc10: "0313000209", watershed: "Long Cane Creek-Chattahoochee River" }, { huc10: "0313001201", watershed: "Marshall Creek" }, { huc10: "0313000406", watershed: "Omusee Creek" }, { huc10: "0313000407", watershed: "Sawhatchee Creek-Chattahoochee River" }, { huc10: "0313000305", watershed: "Uchee Creek" }], [{ huc10: "0314020203", watershed: "Buckhorn Creek" }, { huc10: "0314020112", watershed: "Choctawatchee River" }, { huc10: "0314020208", watershed: "Corner Creek" }, { huc10: "0314020111", watershed: "Double Bridges Creek" }, { huc10: "0314020301", watershed: "East Pittman Creek-Choctawhatchee River" }, { huc10: "0314020207", watershed: "Flat Creek" }, { huc10: "0314020110", watershed: "Hurricane Creek" }, { huc10: "0314020103", watershed: "Judy Creek" }, { huc10: "0314020106", watershed: "Klondike Creek-Choctawatchee River" }, { huc10: "0314020105", watershed: "Little Choctawachee River" }, { huc10: "0314020102", watershed: "Lower East Fork Choctawatchee River" }, { huc10: "0314020206", watershed: "Middle Pea River" }, { huc10: "0314020201", watershed: "Pea Creek" }, { huc10: "0314020108", watershed: "Steep Head Creek" }, { huc10: "0314020107", watershed: "Upper Clay Bank Creek" }, { huc10: "0314020101", watershed: "Upper East Fork Choctawatchee River" }, { huc10: "0314020205", watershed: "Upper Pea River" }, { huc10: "0314020104", watershed: "West Fork Choctawatchee River" }, { huc10: "0314020204", watershed: "Whitewater Creek" }], [{ huc10: "0314010602", watershed: "Bushy Creek-Dyas Creek" }, { huc10: "0314010302", watershed: "Five Runs Creek" }, { huc10: "0314010607", watershed: "Lower Perdido River" }, { huc10: "0314010304", watershed: "Middle Yellow River" }, { huc10: "0314010701", watershed: "Perdido Bay" }, { huc10: "0314010306", watershed: "Pond Creek-Shoal River" }, { huc10: "0314010605", watershed: "Styx River" }, { huc10: "0314010601", watershed: "Upper Perdido River" }, { huc10: "0314010702", watershed: "Wolf Bay Frontal" }], [{ huc10: "0314030503", watershed: "Big Escambia Creek-Escambia River" }, { huc10: "0314030403", watershed: "Burnt Corn Creek" }, { huc10: "0314030405", watershed: "Conecuh River" }, { huc10: "0314030105", watershed: "Lower Conecuh River" }, { huc10: "0314030205", watershed: "Lower Patsaliga Creek" }, { huc10: "0314030307", watershed: "Lower Sepulga River" }, { huc10: "0314030102", watershed: "Mannings Creek" }, { huc10: "0314030104", watershed: "Middle Conecuh River" }, { huc10: "0314030306", watershed: "Middle Sepulga River" }, { huc10: "0314030201", watershed: "Olustee Creek" }, { huc10: "0314030103", watershed: "Upper Conecuh River" }, { huc10: "0314030401", watershed: "Upper Murder Creek" }, { huc10: "0314030301", watershed: "Upper Persimmon Creek" }, { huc10: "0314030304", watershed: "Upper Pigeon Creek" }], [{ huc10: "0316020206", watershed: "Alamuchee Creek" }, { huc10: "0316020307", watershed: "Bassetts Creek" }, { huc10: "0316020405", watershed: "Bay Minette Creek-Mobile River" }, { huc10: "0316020404", watershed: "Bayo Sara-Mobile River" }, { huc10: "0316020401", watershed: "Cedar Creek-Tensaw River" }, { huc10: "0316020502", watershed: "Fish River-Frontal Mobile Bay" }, { huc10: "0316020501", watershed: "Halls Mill Creek" }, { huc10: "0316020207", watershed: "Lower Sucarnoochee River" }, { huc10: "0316020309", watershed: "Lower Tombigbee River" }, { huc10: "0316020204", watershed: "Middle Sucarnoochee River" }, { huc10: "0316020503", watershed: "Mobile Bay" }, { huc10: "0316020402", watershed: "Rains Creek-Tensaw River" }, { huc10: "0316020311", watershed: "Sand Hill Creek-Tombigbee River" }, { huc10: "0316020104", watershed: "Tombigbee River-Cotahaga Creek" }]], mapcenter = null, map = null; $(window).on("load", function () { $("#Search-Type").change(updateSearchType), $("#Data-Type").change(populateSitesList), $("#HUC6-Basin").change(populateHUCWatersheds), $("#HUC10-Watershed").change(populateSitesList), $("#AWW-Watershed").change(populateSitesList), $("#AWW-Group").change(updateSitesViewByGroup), displayContentOverlay(!0), retrieveSites() });