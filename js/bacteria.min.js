function loadData() { token = getToken(); var e = jwt_decode(token); $("#SubmitterContactId").val(e.role[1]), $("div.authorization h2").text("Submitted by: " + e.role[2]), $("#Groupid").val(decodeURIComponent(getQueryVariable("Groupid"))), $("#Group_Name").val(decodeURIComponent(getQueryVariable("Group_Name"))), $("#Group_Abbreviation").val(decodeURIComponent(getQueryVariable("Group_Abbreviation"))), $("#AwwSiteCode").val(decodeURIComponent(getQueryVariable("AwwSiteCode"))), $("#WebMasterSiteId").val(decodeURIComponent(getQueryVariable("WebMasterSiteId"))), $("#Watershed").val(decodeURIComponent(getQueryVariable("Watershed"))), $("#Waterbody_Name").val(decodeURIComponent(getQueryVariable("Waterbody_Name"))), $("#HUC11").val(decodeURIComponent(getQueryVariable("HUC11"))), $("#HUC8").val(decodeURIComponent(getQueryVariable("HUC8"))), $("#HUC6").val(decodeURIComponent(getQueryVariable("HUC6"))), $("#HUC4").val(decodeURIComponent(getQueryVariable("HUC4"))), $("#county").val(decodeURIComponent(getQueryVariable("county"))), $("#state").val(decodeURIComponent(getQueryVariable("state"))), $("#SamplingSiteLocation").val(decodeURIComponent(getQueryVariable("SamplingSiteLocation"))) } function setUpCalculations() { $("#EColi1, #EColi2, #EColi3, #ColonyCount1, #ColonyCount2, #ColonyCount3").keyup(calculateColiformAverage), $("#EColi1, #EColi2, #EColi3, #ColonyCount1, #ColonyCount2, #ColonyCount3").blur(calculateColiformAverage), $("#SampleDate, #SampleTime").keyup(combineDateTime), $("#SampleDate, #SampleTime").blur(combineDateTime), $("#CertificationConfirmation").click(updateAuthorization) } function calculateColiformAverage() { var e = 0, o = 0, a = $("#EColi1"), t = $("#EColi2"), l = $("#EColi3"); a.val().length > 0 && (ecoli1 = parseInt(a.val()), e += ecoli1, o++), t.val().length > 0 && (ecoli2 = parseInt(t.val()), e += ecoli2, o++), l.val().length > 0 && (ecoli3 = parseInt(l.val()), e += ecoli3, o++); var i = ""; o > 0 && (i = Math.ceil(e / o)), $("#ttlecoli").val(i); var n = 0, r = 0, c = $("#ColonyCount1"), d = $("#ColonyCount2"), u = $("#ColonyCount3"); c.val().length > 0 && (ocoli1 = parseInt(c.val()), n += ocoli1, r++), d.val().length > 0 && (ocoli2 = parseInt(d.val()), n += ocoli2, r++), u.val().length > 0 && (ocoli3 = parseInt(u.val()), n += ocoli3, r++); var s = ""; r > 0 && (s = Math.ceil(n / r)), $("#ttlocoli").val(s) } function combineDateTime() { var e = $("#SampleDate").val(), o = $("#SampleTime").val(); e.length > 0 && o.length > 0 ? $("#SampleDateTime").val(e + " " + o) : $("#SampleDateTime").val("") } function updateMonitors() { var e = $("#Monitors ul li input"); $.each(e, function () { var e = $(this); e.prop("checked") ? e.closest("label").addClass("highlite") : e.closest("label").removeClass("highlite") }) } function updateAuthorization() { var e = $("#CertificationConfirmation"); e.prop("checked") ? e.closest("div.authorization").addClass("highlite") : e.closest("div.authorization").removeClass("highlite") } function loadMonitors() { $.support.cors = !0; var e = getToken(); $.ajax({ url: "https://msapps.acesag.auburn.edu/aww/api/home/GetSiteMonitors", dataType: "json", type: "GET", data: { id: $("#WebMasterSiteId").val() }, contentType: "application/json", headers: { Authorization: "Bearer " + e }, cache: !1, success: function (e) { var o = $("#Monitors ul"); $.each(e.monitors, function (e, a) { var t = $("<li></li>"), l = $("<label>" + a.firstName + " " + a.lastName + "</label>"), i = $('<input type="checkbox" value="' + a.contactID + '" name="MonitorIDs" ml-val ml-val-required="true" ml-val-label="A monitor is required."/>'); i.click(updateMonitors), o.append(t), t.append(l), l.append(i), loadAutoSaveAndLocal() }) }, error: function (e, o, a) { displayErrorMessage(!0, "An error has occurred.  No monitors for this site were found.  Your entry will be saved, but monitors must be added to submit.") } }) } function loadBacteria() { loadData(), setUpCalculations(), loadMonitors() } function loadAutoSaveAndLocal() { storedKeyName = $("#AwwSiteCode").val() + "-bacteria", loadLocallyStored(storedKeyName), setUpAutoSave($("form.ml-validation"), storedKeyName), updateMonitors(), updateAuthorization() } function submitBactForm(e, o) { if (displayContentOverlay(!0), o) { var a = $(e), t = a.closest("form.ml-validation"); $.support.cors; var l = getToken(), i = t.serialize(), n = t.attr("ml-post-to"); $.ajax({ url: n, type: "POST", headers: { Authorization: "Bearer " + l }, data: i, dataType: "json", cache: !1, success: function (e) { var o = $("#AwwSiteCode").val(); t.hide(), clearLocallyStoredForm(o + "-bacteria"), displayContentOverlay(!1), $("#Success-Section").show() }, error: function (e, o, a) { displayErrorMessage(!0, "An error has occurred.  Bacteria data could not be submitted.  Your entry is saved and can be submitted at a later time."), displayContentOverlay(!1) } }) } else displayContentOverlay(!1) } var storedKeyName = null; $(window).on("load", function () { validateToken(loadBacteria) });